<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KANSAI TRIP - è¡Œç¨‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* éš±è—æ»¾å‹•æ¢çš„æ¨£å¼ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* é é¢é€²å…¥çš„å‹•ç•« */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        /* ç¢ºä¿åº•éƒ¨å®‰å…¨å€ */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body class="bg-stone-100 font-sans text-stone-900">

    <div id="app-container" class="md:max-w-md md:mx-auto shadow-2xl overflow-hidden relative min-h-screen pb-20">
        
        <div id="header-container" class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b border-stone-200 shadow-sm">
            </div>

        <div id="main-content-area" class="p-4 space-y-4">
            </div>

        <div id="bottom-nav-container" class="fixed bottom-0 left-0 right-0 bg-white border-t border-stone-200 md:max-w-md md:mx-auto pb-safe safe-area-bottom z-50">
            </div>
        
    </div>

    <script>
        // --- 1. Data Structure (å·²æ–°å¢ image å±¬æ€§) ---
        const TRIP_DATA = {
            flights: [
                {
                    type: "Departure",
                    date: "2025/12/27 (å…­)",
                    code: "CX564",
                    airline: "åœ‹æ³°èˆªç©º",
                    route: "TPE å°åŒ— (11:15) â” KIX å¤§é˜ª (14:55)",
                    terminal: "TPE T1 / KIX T1",
                    duration: "2h 40m",
                    aircraft: "Airbus A330-300",
                    class: "ç¶“æ¿Ÿ Q"
                },
                {
                    type: "Return",
                    date: "2026/01/04 (æ—¥)",
                    code: "CX565",
                    airline: "åœ‹æ³°èˆªç©º",
                    route: "KIX å¤§é˜ª (16:15) â” TPE å°åŒ— (18:30)",
                    terminal: "KIX T1 / TPE T1",
                    duration: "3h 25m",
                    aircraft: "Airbus A330-300",
                    class: "ç¶“æ¿Ÿ S"
                }
            ],
            hotels: [
                {
                    name: "è‰æ´¥æ³¢å£«é “å»£å ´é£¯åº—",
                    engName: "Hotel Boston Plaza Kusatsu",
                    dates: "12/27 - 1/1 (5æ™š)",
                    location: "æ»‹è³€ç¸£è‰æ´¥å¸‚ (JRè‰æ´¥ç«™æ—)",
                    features: ["äº¤é€šä¾¿åˆ©", "ç¾å¼é¢¨æ ¼", "é©åˆè‡ªé§•"],
                    note: "ä½œç‚ºæ»‹è³€ç¸£äººå­”è“‹å¡æ”¶é›†çš„åŸºåœ°éå¸¸åˆé©ã€‚",
                    image: "Boston.jpg" // ã€æ–°å¢åœ–ç‰‡è·¯å¾‘ã€‘
                },
                {
                    name: "REF äº¬éƒ½å…«æ¢å£ by VESSEL HOTELS",
                    engName: "REF Kyoto Hachijoguchi",
                    dates: "1/1 - 1/4 (3æ™š)",
                    location: "äº¬éƒ½å¸‚å—å€ (äº¬éƒ½ç«™å…«æ¢å£)",
                    features: ["å¤§æµ´å ´", "ç¾ä»£æ—¥å¼", "å…è²»è¿è³“é£²æ–™"],
                    note: "é è¿‘äº¬éƒ½è»Šç«™ï¼Œæ–¹ä¾¿å‰å¾€ç¥æˆ¶ã€å¥ˆè‰¯èˆ‡å›ç¨‹æ©Ÿå ´ã€‚",
                    image: "Kyoto.jpg" // ã€æ–°å¢åœ–ç‰‡è·¯å¾‘ã€‘
                }
            ],
            itinerary: [
                {
                    id: "day1", date: "12/27", dayOfWeek: "å…­", location: "å¤§é˜ª â” æ»‹è³€", weather: "sunny", temp: "8Â°C", items: [
                        { type: "transport", time: "11:15", title: "æ­ä¹˜ CX564 é£›å¾€å¤§é˜ª", note: "é è¨ˆ 14:55 æŠµé”é—œè¥¿æ©Ÿå ´ T1" },
                        { type: "visit", time: "15:30", title: "è‡¨ç©ºåŸè§€å…‰æ¡ˆå…§æ‰€", tag: "æ”¶é›†", note: "ğŸ”¥ é ˜å–äººå­”è“‹å¡/ç´€å¿µå“ã€‚ç‡Ÿæ¥­è‡³20:00ã€‚", mapUrl: "https://maps.app.goo.gl/UVryLTpB5AXKVc8i7" },
                        { type: "shop", time: "16:00", title: "è‡¨ç©ºåŸ Outlet", highlight: "å¿…è²·: é‹å‹•å“ç‰Œã€æ—¥ç³»æœé£¾", note: "æ™šé¤å¯åœ¨æ­¤è§£æ±ºã€‚ç‡Ÿæ¥­è‡³20:00ã€‚" },
                        { type: "transport", time: "19:00", title: "å‰å¾€è‰æ´¥", note: "é—œè¥¿æ©Ÿå ´ â†’ äº¬éƒ½è»Šç«™ â†’ è‰æ´¥è»Šç«™" },
                        { type: "hotel", time: "21:30", title: "å…¥ä½ï¼šè‰æ´¥æ³¢å£«é “å»£å ´é£¯åº—", note: "ä½æ–¼è‰æ´¥ç«™è¥¿å£ï¼Œä¼‘æ¯æº–å‚™æ˜æ—¥è‡ªé§•ã€‚" }
                    ]
                },
                {
                    id: "day2", date: "12/28", dayOfWeek: "æ—¥", location: "æ»‹è³€è‡ªé§•", weather: "cloudy", temp: "6Â°C", items: [
                        { type: "transport", time: "08:00", title: "ç§Ÿè»Šï¼šToyota Rent a Car", note: "è‰æ´¥ç«™è¥¿å£åº—å–è»Šã€‚", mapUrl: "https://maps.app.goo.gl/XXatzeRDqj2tiShL8" },
                        { type: "visit", time: "09:40", title: "Kusatsu Yume-Honjin", tag: "æ”¶é›†", note: "ãã•ã¤å¤¢æœ¬é™£ï¼Œé ˜å–äººå­”è“‹å¡ã€‚09:30é–‹é–€ã€‚", parkingUrl: "https://maps.app.goo.gl/Lf1o3FuKd7LWJ36V9" },
                        { type: "visit", time: "10:20", title: "æ —æ±è¦³å…‰æ¡ˆå†…æ‰€ (2F)", tag: "æ”¶é›†", note: "ä½æ–¼æ‰‹åŸç«™ã€‚æ³¨æ„ç‡Ÿæ¥­æ™‚é–“è‡³12:00 (é€šå¸¸å‡æ—¥å¯èƒ½æœ‰è®Šå‹•ï¼Œè«‹å„ªå…ˆå‰å¾€)ã€‚" },
                        { type: "visit", time: "11:00", title: "å®ˆå±±å¸‚é§…å‰ç·åˆæ¡ˆå†…æ‰€", tag: "æ”¶é›†", note: "ä½æ–¼å®ˆå±±ç«™ã€‚07:30æ—©é–‹ã€‚" },
                        { type: "visit", time: "12:00", title: "å…«æ—¥å¸‚é§…å‰è¦³å…‰äº¤æµæ–½è¨­", tag: "æ”¶é›†", note: "æ±è¿‘æ±Ÿå¸‚çš„å¤§é¢¨ç®åšç‰©é¤¨é™„è¿‘ã€‚" },
                        { type: "visit", time: "13:00", title: "æ±è¿‘æ±Ÿå¸‚å½¹æ‰€ å®ˆè¡›å®¤", tag: "æ”¶é›†", note: "ç‡Ÿæ¥­æ™‚é–“ (10:00â€“16:00)ã€‚è«‹ç¢ºèªå®ˆè¡›å®¤ä½ç½®ã€‚", mapUrl: "https://maps.app.goo.gl/eJnRvFv5Mxpjhdm36" },
                        { type: "visit", time: "14:00", title: "å½¥æ ¹å¸‚ä¸Šä¸‹æ°´é“ä¸­å¿ƒ", tag: "æ”¶é›†", note: "éœ€å¹³æ—¥æˆ–ç‰¹å®šå‡æ—¥çª—å£ï¼Œè«‹ç¢ºèªå®ˆè¡›å®¤ä½ç½®ã€‚", mapUrl: "https://maps.app.goo.gl/mjrFPtwqrfi5BxEY8" },
                        { type: "visit", time: "14:30", title: "Hikonyan Museum", highlight: "å¿…çœ‹: å½¥æ ¹è²“(Hikonyan)è¡¨æ¼”å ´æ¬¡", note: "ğŸ”¥ å½¥æ ¹è²“åšç‰©é¤¨ã€‚", mapUrl: "https://maps.app.goo.gl/QvCVdj1AwLFr6VWH9" },
                        { type: "visit", time: "15:30", title: "å½¥æ ¹åŸ", highlight: "åœ‹å¯¶äº”åŸ", note: "è³æ«»åæ‰€(é›–æ˜¯å†¬å¤©)ã€‚", mapUrl: "https://maps.app.goo.gl/eWDQpCqRV9cZQBVC7" },
                        { type: "shop", time: "17:30", title: "MITSUI OUTLET PARK æ»‹è³€é¾ç‹", highlight: "é—œè¥¿æœ€å¤§ç´š Outlet", note: "æ™šé¤æ¨è–¦è¿‘æ±Ÿç‰›æ–™ç†ã€‚" }
                    ]
                },
                {
                    id: "day3", date: "12/29", dayOfWeek: "ä¸€", location: "æµ·ä¹‹äº¬éƒ½", weather: "rain", temp: "4Â°C", items: [
                        { type: "visit", time: "09:00", title: "ä¼Šæ ¹ç£è³æ™¯è§€å…‰èˆ¹", highlight: "å¿…æ‹: èˆŸå±‹ç¾¤", note: "è³¼è²·è¦æ¢é¤µæµ·é·—ã€‚éŠè¦½æ™‚é–“ç´„25åˆ†é˜ã€‚" },
                        { type: "visit", time: "10:30", title: "é“ã®é§… æµ·ã®äº¬éƒ½ å®®æ´¥", tag: "æ”¶é›†", note: "å®®æ´¥è§€å…‰æ¡ˆå…§æ‰€é ˜å–äººå­”è“‹å¡ã€‚" },
                        { type: "food", time: "12:00", title: "åˆé¤ï¼šå¤©æ©‹ç«‹å‘¨é‚Š", highlight: "å¿…åƒ: è›¤è £ä¸¼ (Asari Don)", note: "æ¨è–¦ï¼šå¯Œç”°å±‹ (æµ·é®®è¶…å€¼)ã€Suginoyaã€æµ·é®®å·¥æˆ¿ã€‚" },
                        { type: "visit", time: "13:30", title: "å¤©æ©‹ç«‹ (å‚˜æ¾å…¬åœ’)", highlight: "æ—¥æœ¬ä¸‰æ™¯", note: "æ­ä¹˜çºœè»Š/åŠæ¤…ä¸Šå±±ï¼Œå¾èƒ¯ä¸‹çªºçœ‹ã€Œé£›é¾åœ¨å¤©ã€ã€‚" },
                        { type: "visit", time: "15:00", title: "å…ƒä¼Šå‹¢ ç± ç¥ç¤¾ & æ™ºæ©å¯º", note: "åƒæ‹œå¤è€ç¥ç¤¾ã€‚" },
                        { type: "visit", time: "16:00", title: "å¤©æ©‹ç«‹ View Land", note: "å¾å¦ä¸€å´çœ‹é£›é¾è§€ã€‚æ³¨æ„çºœè»Šæœ«ç­æ™‚é–“ (å†¬å­£ç´„16:30-17:00)ã€‚" }
                    ]
                },
                {
                    id: "day4", date: "12/30", dayOfWeek: "äºŒ", location: "é•·æ¿±/çµç¶æ¹–", weather: "cloudy", temp: "5Â°C", items: [
                        { type: "visit", time: "08:50", title: "ç«¹ç”Ÿå³¶è§€å…‰èˆ¹", note: "å¾é•·æ¿±æ¸¯å‡ºç™¼ã€‚ç«¹ç”Ÿå³¶æ˜¯èƒ½é‡æ™¯é» (Power Spot)ã€‚" },
                        { type: "visit", time: "10:00", title: "ç«¹ç”Ÿå³¶ å¯¶åš´å¯º", highlight: "æŠ•æ“²ç“¦ç‰‡ç¥ˆç¦", note: "åƒæ‹œå¼è²¡å¤©ã€‚" },
                        { type: "visit", time: "12:00", title: "é»‘å£å»£å ´ (é»‘å£Square)", highlight: "å¿…åƒ: 96Cafe é»‘å’–å“©", note: "ç»ç’ƒå·¥è—å“åº—æ—ç«‹ï¼Œå……æ»¿å¤§æ­£æµªæ¼«æ°›åœã€‚" },
                        { type: "visit", time: "14:30", title: "å¤šè³€å¤§ç¤¾", highlight: "é•·å£½ç¥ˆé¡˜", note: "æ»‹è³€ç¸£ç¬¬ä¸€å¤§ç¤¾ï¼Œé–€å£æœ‰è‘—åã€Œç³¸åˆ‡é¤…ã€ã€‚" },
                        { type: "visit", time: "16:00", title: "è¿‘æ±Ÿç¥å®®", highlight: "èŠ±ç‰Œæƒ…ç·£è–åœ°", note: "ä»¥ç«¶æŠ€æ­Œç‰Œèåï¼Œå»ºç¯‰æœ±ç´…ç¾éº—ã€‚" }
                    ]
                },
                {
                    id: "day5", date: "12/31", dayOfWeek: "ä¸‰", location: "è¿‘æ±Ÿå…«å¹¡", weather: "snow", temp: "3Â°C", items: [
                        { type: "transport", time: "08:00", title: "æ—¥ç‰Ÿç¦®å…«å¹¡å®®å‰ ç„¡æ–™é§è»Šå ´ï¼ˆé‡Œé“ï¼‰", note: "æ–°å¹´åƒæ‹œæˆ–éŠè¦½å…«å¹¡å €å‰åœè»Šã€‚" },
                        { type: "visit", time: "09:00", title: "å…«å¹¡å±±çºœè»Š & åŸè·¡", note: "çœºæœ›çµç¶æ¹–èˆ‡è¥¿ä¹‹æ¹–ç¾æ™¯ã€‚", mapUrl: "https://maps.app.goo.gl/xxNq6zPaK8AKbENc7" },
                        { type: "visit", time: "10:30", title: "å…«å¹¡å €éŠèˆ¹", highlight: "æ™‚ä»£åŠ‡å–æ™¯åœ°", note: "åœ¨å……æ»¿é¢¨æƒ…çš„æ°´é„‰ä¹˜èˆ¹æ¼«éŠã€‚" },
                        { type: "visit", time: "12:30", title: "La Collina è¿‘æ±Ÿå…«å¹¡", highlight: "å¿…è²·: Club Harie å¹´è¼ªè›‹ç³•", note: "å»ºç¯‰å¤§å¸«è—¤æ£®ç…§ä¿¡è¨­è¨ˆçš„ç«¥è©±è‰å±‹ã€‚å¿…åƒç¾çƒ¤å¹´è¼ªè›‹ç³•ã€éŠ…é‘¼ç‡’ã€‚" },
                        { type: "food", time: "17:00", title: "è·¨å¹´æ™šé¤", note: "å»ºè­°æå‰é è¨‚é¤å»³ï¼Œæˆ–åœ¨è¶…å¸‚è³¼è²·è±ç››æ™šé¤å›é£¯åº—äº«ç”¨ã€‚", mapUrl: null },
                        { type: "transport", time: "20:00", title: "é‚„è»Šï¼šãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ãƒªãƒ¼ã‚¹æ»‹è³€ è‰æ´¥é§…è¥¿å£åº—", note: "å‹™å¿…æ–¼ 20:00 å‰å®Œæˆé‚„è»Šæ‰‹çºŒï¼ŒçµæŸè‡ªé§•è¡Œç¨‹ã€‚", mapUrl: "https://maps.app.goo.gl/ingUdcVCj5Y5LhLN9" }
                    ]
                },
                {
                    id: "day6", date: "1/1", dayOfWeek: "å››", location: "ç¥æˆ¶/åˆè©£", weather: "sunny", temp: "7Â°C", items: [
                        { type: "transport", time: "08:00", title: "ç§»å‹•è‡³äº¬éƒ½ä¸¦å‰å¾€ç¥æˆ¶", note: "å…ˆå» REF äº¬éƒ½é£¯åº—å¯„æ”¾è¡Œæï¼Œå†æ­é˜ªæ€¥å‰å¾€ç¥æˆ¶ä¸‰å®®ã€‚", mapUrl: "https://maps.app.goo.gl/gdCQLpzYYo78Ros97" },
                        { type: "visit", time: "10:30", title: "ç”Ÿç”°ç¥ç¤¾", highlight: "æˆ€æ„›çµç·£", note: "æ–°å¹´åƒæ‹œ (åˆè©£) äººæ½®çœ¾å¤šï¼Œè«‹é ç•™æ™‚é–“ã€‚", mapUrl: "https://maps.app.goo.gl/v7NQuRiXvfBZx2Rd6" },
                        { type: "visit", time: "12:00", title: "åŒ—é‡å¤©æ»¿ç¥ç¤¾", note: "ä½æ–¼ç•°äººé¤¨å€çš„é«˜é»ã€‚" },
                        { type: "visit", time: "14:00", title: "ç¥æˆ¶æ©Ÿå ´ ç¶œåˆæ¡ˆå…§æ‰€", tag: "æ”¶é›†", note: "é ˜å–äººå­”è“‹å¡ã€‚æ­ä¹˜ Port Liner å‰å¾€ã€‚", mapUrl: "https://maps.app.goo.gl/TuRERrWKsxrhMFnn9" },
                        { type: "visit", time: "16:30", title: "å¤§é³¥å¤§ç¤¾", tag: "æ”¶é›†", note: "å¤§é˜ªå ºå¸‚ã€‚é †è·¯åƒæ‹œã€‚", mapUrl: "https://maps.app.goo.gl/CkuALVojEmQMqWt1A" },
                        { type: "shop", time: "18:30", title: "å¯¶å¯å¤¢ä¸­å¿ƒ å¤§é˜ªåº— DXå¤§ä¸¸å¿ƒé½‹æ©‹9F", highlight: "å¿…è²·: é™å®šå•†å“", note: "ç‡Ÿæ¥­æ™‚é–“10:00â€“20:00ã€‚æ™šé¤å¯åœ¨æ­¤é™„è¿‘è§£æ±ºã€‚", mapUrl: "https://maps.app.goo.gl/jKdYCMRwBqkRJWP57" },
                        { type: "shop", time: "20:00", title: "å¯¶å¯å¤¢ä¸­å¿ƒ å¤§é˜ªå¤§ä¸¸æ¢…ç”°13F", highlight: "å¿…è²·: é™å®šå•†å“", note: "âš ï¸ ç‡Ÿæ¥­æ™‚é–“10:00â€“20:00ã€‚è«‹æ³¨æ„ï¼Œå¿ƒé½‹æ©‹èˆ‡æ¢…ç”°å…©åº—çš†æ–¼20:00é—œé–€ï¼Œå»ºè­°é¸æ“‡å…¶ä¸€æˆ–æå‰èª¿æ•´è¡Œç¨‹ã€‚", mapUrl: "https://maps.app.goo.gl/xGUHRZFaZtQfp5m39" }
                    ]
                },
                {
                    id: "day7", date: "1/2", dayOfWeek: "äº”", location: "å¥ˆè‰¯/å®‡æ²»", weather: "sunny", temp: "6Â°C", items: [
                        { type: "visit", time: "08:30", title: "æ˜¥æ—¥å¤§ç¤¾", highlight: "é¹¿èˆ‡ç‡ˆç± ", note: "åƒé“ä¸Šçš„é¹¿ç¾¤å¾ˆå¯æ„›ä½†è«‹å°å¿ƒä»™è²ã€‚" },
                        { type: "food", time: "11:00", title: "æ°´è°·èŒ¶å±‹", highlight: "èŒ…è‰å±‹èŒ¶å±‹", note: "æ‹ç…§è¶…ç¾ï¼Œæ¨è–¦çƒé¾éºµæˆ–è•¨é¤…ã€‚" },
                        { type: "visit", time: "12:30", title: "æ±å¤§å¯º & äºŒæœˆå ‚", highlight: "ä¸–ç•Œæœ€å¤§æœ¨é€ å»ºç¯‰", note: "å¿…çœ‹å¤§ä½›ã€‚äºŒæœˆå ‚å¯ä¿¯ç°å¥ˆè‰¯å¸‚æ™¯ã€‚" },
                        { type: "visit", time: "13:30", title: "å¾¡éœŠç¥ç¤¾", note: "å¥ˆè‰¯å¸‚å¾¡éœŠç¥ç¤¾ã€‚", mapUrl: "https://maps.app.goo.gl/skHV4mytKdyAPfFe7" },
                        { type: "visit", time: "14:30", title: "å¥ˆè‰¯ç”ºå—è¦³å…‰æ¡ˆå†…æ‰€", tag: "æ”¶é›†", note: "é ˜å–å¥ˆè‰¯äººå­”è“‹å¡ã€‚" },
                        { type: "visit", time: "15:30", title: "å®‡æ²»è¦³å…‰ã‚»ãƒ³ã‚¿ãƒ¼", tag: "æ”¶é›†", note: "é ˜å–å®‡æ²»äººå­”è“‹å¡ã€‚é †ä¾¿é€›è¡¨åƒé“ã€‚" },
                        { type: "shop", time: "16:30", title: "å‰ä¼Šå¡å“‡ (Chikawa) ä¼è¦‹åº—", highlight: "äº¬éƒ½é™å®š", note: "Mogumogu æœ¬èˆ–ã€‚å¿…è²·ä¼è¦‹ç¨»è·é™å®šå‘¨é‚Šã€‚" }
                    ]
                },
                {
                    id: "day8", date: "1/3", dayOfWeek: "å…­", location: "äº¬éƒ½å·¡ç¦®", weather: "cloudy", temp: "5Â°C", items: [
                        { type: "visit", time: "08:30", title: "å¤©é¾å¯º (åµå±±)", highlight: "æ›¹æºæ± åº­åœ’", note: "ä¸–ç•Œéºç”¢ã€‚æ—©æ™¨äººè¼ƒå°‘ï¼Œç©ºæ°£æ¸…æ–°ã€‚" },
                        { type: "visit", time: "10:30", title: "å°‹æ‰¾é³³ç‹äººå­”è“‹", tag: "æ”¶é›†", note: "å¯¶å¯å¤¢äººå­”è“‹ã€é³³ç‹ã€ä½æ–¼äº¬éƒ½ï¼ˆé€šå¸¸åœ¨å…¬åœ’æˆ–åœ°æ¨™å‰ï¼‰ã€‚", mapUrl: "https://maps.app.goo.gl/CJcLqbAjMk3WNXCF8" },
                        { type: "visit", time: "13:00", title: "ä»å’Œå¯º", note: "ä»¥å¾¡å®¤æ«»èåï¼ˆé›–éèŠ±å­£ï¼‰ï¼Œçš‡å®¤æ·µæºæ·±åšã€‚" },
                        { type: "visit", time: "15:00", title: "å¹³å®‰ç¥å®®", note: "å·¨å¤§çš„ç´…è‰²é³¥å±…ã€‚è…¹åœ°å»£å¤§ã€‚" },
                        { type: "shop", time: "16:30", title: "Pokemon Center Kyoto", highlight: "è—å¦“çš®å¡ä¸˜", note: "ä½æ–¼ SUINA å®¤ç”º 2Fã€‚å¿…è²·äº¬éƒ½é™å®šç©å¶ã€‚" },
                        { type: "shop", time: "18:00", title: "å‰ä¼Šå¡å“‡ Land äº¬éƒ½å››æ¢æ²³åŸç”º", note: "Kiddyland å…§ã€‚ç¹¼çºŒè£œè²¨ã€‚", mapUrl: "https://maps.app.goo.gl/BbcuK4g3LP7XfX3QA" }
                    ]
                },
                {
                    id: "day9", date: "1/4", dayOfWeek: "æ—¥", location: "å¤§é˜ª â” å°åŒ—", weather: "sunny", temp: "8Â°C", items: [
                        { type: "transport", time: "08:12", title: "å‰å¾€å¤§é˜ª", note: "äº¬éƒ½è»Šç«™ â†’ å¤§é˜ªï¼ˆå¯„æ”¾è¡Œææˆ–ç›´æ¥å‰å¾€æ™¯é»ï¼‰ã€‚" },
                        { type: "visit", time: "09:30", title: "ATC Green Eco Plaza", note: "ä½æ–¼å—æ¸¯ã€‚å…¼å…·ç’°ä¿æ•™è‚²èˆ‡è§€å…‰ã€‚" },
                        { type: "visit", time: "11:00", title: "å ºæ±è¦³å…‰æ¡ˆå†…æ‰€", tag: "æ”¶é›†", note: "é ˜å–å ºå¸‚äººå­”è“‹å¡ã€‚" },
                        { type: "visit", time: "12:00", title: "å²¸å’Œç”°ç«™å‰è§€å…‰æ¡ˆå…§æ‰€", tag: "æ”¶é›†", note: "ä»¥å²¸å’Œç”°ç¥­ï¼ˆæ‹‰è»Šç¥­ï¼‰èåã€‚", mapUrl: "https://maps.app.goo.gl/2oxEhfudZTzA9ctW7" },
                        { type: "visit", time: "13:30", title: "ã¾ã¡ã®é§…ã‹ã„ã¥ã‹", tag: "æ”¶é›†", note: "è²å¡šå¸‚äººå­”è“‹å¡ã€‚ç‡Ÿæ¥­æ™‚é–“10:00â€“19:00ã€‚", mapUrl: "https://maps.app.goo.gl/r89Sw7x95XutLG3i8" },
                        { type: "visit", time: "15:00", title: "æ³‰ä½é‡å¸‚è¦³å…‰æƒ…å ±ã‚»ãƒ³ã‚¿ãƒ¼", tag: "æ”¶é›†", note: "é—œè¥¿æ©Ÿå ´å°å²¸ï¼Œæœ€å¾Œä¸€ç«™æ”¶é›†ï¼" },
                        { type: "transport", time: "16:15", title: "æ­ä¹˜ CX565 è¿”å°", note: "å†è¦‹é—œè¥¿ï¼é è¨ˆ 18:30 æŠµé”å°åŒ—ã€‚" }
                    ]
                }
            ],
            manholeStock: [
                { name: "è‡¨ç©ºåŸæ¡ˆå…§æ‰€", region: "å¤§é˜ª", hours: "09:00â€“20:00", url: "https://www.city.izumisano.lg.jp/kakuka/jogesuidokyoku/jogesui/menu/1511934914176.html" },
                { name: "å¤§æ´¥è»Šç«™è§€å…‰æ¡ˆå†…æ‰€", region: "æ»‹è³€", hours: "09:00â€“18:00", url: "https://www.city.otsu.lg.jp/kigyo/about/koho/68041.html", highlight: true },
                { name: "ãã•ã¤å¤¢æœ¬é™£", region: "æ»‹è³€", hours: "09:00â€“17:00", url: "https://www.city.kusatsu.shiga.jp/kurashi/suidogesuido/gesuido/manholecard.html" },
                { name: "è‰æ´¥å®¿è¡—é“äº¤æµé¤¨", region: "æ»‹è³€", hours: "09:00â€“17:00", url: "https://www.city.kusatsu.shiga.jp/kurashi/suidogesuido/gesuido/manholecard.html" },
                { name: "æ —æ±è¦³å…‰æ¡ˆå†…æ‰€ äºŒæ¨“", region: "æ»‹è³€", hours: "08:30â€“12:00", url: "https://www.city.ritto.lg.jp/soshiki/jogeuido/jogesuido/oshirase/7224.html" },
                { name: "æ —æ±å¸‚ç«‹å›³æ›¸é¤¨", region: "æ»‹è³€", hours: "10:00â€“17:00", url: "https://www.city.ritto.lg.jp/soshiki/jogeuido/jogesuido/oshirase/7224.html", highlight: true },
                { name: "å®ˆå±±å¸‚é§…å‰ç·åˆæ¡ˆå†…æ‰€", region: "æ»‹è³€", hours: "07:30â€“19:30", url: "https://www.city.moriyama.lg.jp/kurashitetsuzuki/jougesuido/1001701/1008797.html" },
                { name: "å…«æ—¥å¸‚é§…å‰è¦³å…‰äº¤æµæ–½è¨­", region: "æ»‹è³€", hours: "10:00â€“17:00", url: "https://www.city.higashiomi.shiga.jp/kurashi_tetsuzuki/jougesuidou/1008975/1009690.html" },
                { name: "æ±è¿‘æ±Ÿå¸‚å½¹æ‰€ å®ˆè¡›å®¤", region: "æ»‹è³€", hours: "10:00â€“16:00", url: "https://www.city.higashiomi.shiga.jp/kurashi_tetsuzuki/jougesuidou/1008975/1008976.html", highlight: false },
                { name: "è±Šéƒ·ç”ºè¦³å…‰æ¡ˆå†…æ‰€", region: "æ»‹è³€", hours: "09:00â€“17:00", url: "https://www.town.toyosato.shiga.jp/0000001749.html", highlight: true },
                { name: "å½¥æ ¹å¸‚ä¸Šä¸‹æ°´é“æ–™é‡‘ãŠå®¢æ§˜ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼", region: "æ»‹è³€", hours: "09:00â€“17:00", url: "https://www.city.hikone.lg.jp/kakuka/jogesuido/2/2219.html" },
                { name: "ã²ã“ã­é£Ÿè³“é¤¨å››ç•ªç”ºãƒ€ã‚¤ãƒ‹ãƒ³ã‚°", region: "æ»‹è³€", hours: "10:00â€“17:00", url: "https://www.city.hikone.lg.jp/kakuka/jogesuido/2/2219.html" },
                { name: "ã€Œé“ã®é§… æµ·ã®äº¬éƒ½ å®®æ´¥ã€è¦³å…‰æ¡ˆå†…æ‰€", region: "äº¬éƒ½", hours: "09:00â€“18:00", url: "https://www.pref.kyoto.jp/gesuido/manholemiyazu.html" },
                { name: "ç¥æˆ¸ç©ºæ¸¯ 1 éšç·åˆæ¡ˆå†…æ‰€", region: "å…µåº«", hours: "07:00â€“23:00", url: "https://www.city.kobe.lg.jp/a78445/kurashi/sumai/sewage/pr/manhole_card.html" },
                { name: "èŠ¦å±‹å¸‚å½¹æ‰€å®ˆè¡›å®¤", region: "å…µåº«", hours: "09:00â€“17:00", url: "https://www.city.ashiya.lg.jp/gesuidou/mhc.html", highlight: true },
                { name: "å¤§é˜ªè¦³å…‰æ¡ˆå†…æ‰€(JR è»Šç«™å…§)", region: "å¤§é˜ª", hours: "07:00â€“21:00", url: "https://www.city.osaka.lg.jp/kensetsu/page/0000431121.html" },
                { name: "å¥ˆè‰¯ç”ºå—è¦³å…‰æ¡ˆå†…æ‰€", region: "å¥ˆè‰¯", hours: "09:00â€“17:00", url: "https://h2o.nara.nara.jp/info_924.html" },
                { name: "å®‡æ²»å¸‚è¦³å…‰ã‚»ãƒ³ã‚¿ãƒ¼", region: "äº¬éƒ½", hours: "09:00â€“17:00", url: "https://www.city.uji.kyoto.jp/soshiki/12/6038.html" },
                { name: "å¤§é˜ªå¸‚ä¸‹æ°´é“ç§‘å­¸é¤¨(éœ€è³¼ç¥¨å…¥å ´å¾Œå¡«å¯«å•åˆ¸)", region: "å¤§é˜ª", hours: "09:30â€“17:00", url: "https://www.city.osaka.lg.jp/kensetsu/page/0000431121.html", highlight: true },
                { name: "ãŠãŠã•ã‹ ATC ã‚°ãƒªãƒ¼ãƒ³ã‚¨ã‚³ãƒ—ãƒ©ã‚¶", region: "å¤§é˜ª", hours: "10:00â€“17:00", url: "https://www.city.osaka.lg.jp/kensetsu/page/0000431121.html" },
                { name: "å ºæ±è¦³å…‰æ¡ˆå†…æ‰€", region: "å¤§é˜ª", hours: "09:00â€“19:00", url: "https://water.city.sakai.lg.jp/about/kouhou/1522311572373.html" },
                { name: "å²¸å’Œç”°é§…å‰è¦³å…‰æ¡ˆå†…æ‰€", region: "å¤§é˜ª", hours: "09:00â€“17:00", url: "https://www.city.kishiwada.lg.jp/page/56-manholecard.html" },
                { name: "ã¾ã¡ã®é§…ã‹ã„ã¥ã‹", region: "å¤§é˜ª", hours: "10:00â€“19:00", url: "https://www.city.kaizuka.lg.jp/kakuka/jogesuido/gesuisuisin/topics/manholucard.html" },
                { name: "æ³‰ä½é‡å¸‚è¦³å…‰æƒ…å ±ã‚»ãƒ³ã‚¿ãƒ¼", region: "å¤§é˜ª", hours: "10:00â€“16:00", url: "https://www.city.izumisano.lg.jp/kakuka/jogesuidokyoku/jogesui/menu/1511934914176.html" },
            ],
            notes: [
                {
                    date: "12/27ï¼ˆå…­ï¼‰",
                    links: [
                        { title: "è‡¨ç©ºåŸ Outlet é›»å­åœ°åœ–", url: "https://platinumaps.jp/d/premiumoutlets-rinku?floor=1F", note: "Nikeæ²’æœ‰å…ç¨…" }
                    ],
                    dining: [
                        { name: "æ±äº¬æ²¹çµ„ç·æœ¬åº— æ»‹è³€çµ„", hours: "11:00â€“02:00", mapUrl: "https://maps.app.goo.gl/w2thGKHypz1hWEqLA" },
                        { name: "éººå±‹EDITIONè‰æ´¥åº—", hours: "17:00â€“02:45" },
                        { name: "ã‚«ãƒãƒ‰ã®ã‚¿ã‚³", hours: "12:00â€“23:00 (å±…é…’å±‹)", mapUrl: "https://maps.app.goo.gl/gkScoEZv4zvpATxVA" }
                    ]
                },
                {
                    date: "12/28ï¼ˆæ—¥ï¼‰",
                    links: [
                        { title: "MITSUI OUTLET PARK æ»‹è³€é¾ç‹åœ°åœ–", url: "https://mitsui-shopping-park.com/mop/file/filer/shiga/floor/00008_fo.pdf", note: "PDFä¸‹è¼‰" }
                    ]
                },
                {
                    date: "12/29ï¼ˆä¸€ï¼‰",
                    links: [
                        { title: "ä¼Šæ ¹æ¹¾ã‚ãã‚ŠéŠè¦§èˆ¹", url: "https://www.inewan.com/inewan_cruise/", note: "1,200å††" },
                        { title: "å‚˜æ¾è¦³å…‰åˆ¸", url: "https://www.tankai.jp/tourist_tickets/#inekasamatsu", note: "2,000å††åˆ¸" },
                        { title: "å¤©æ©‹ç«‹ãƒ“ãƒ¥ãƒ¼ãƒ©ãƒ³ãƒ‰ (çºœè»Š)", url: "https://www.viewland.jp/tw/eigyou/", note: "1,000å††" }
                    ],
                    dining: [
                        { area: "å‚˜æ¾", spots: [{ name: "Suginoya", hours: "11:30â€“16:00", note: "çƒå†¬" }] },
                        { area: "å¤©æ©‹ç«‹", spots: [{ name: "æµ·é®®å·¥æˆ¿ æ©‹ç«‹ç‰©ç”¢ æ¾è‘‰èŸ¹ç›´è³£", hours: "11:00â€“17:00" }] },
                        { area: "å®®æ´¥åˆé¤", spots: [
                            { name: "çƒå†¬å°åƒå¤§é–€", hours: "11:30â€“14:30ã€17:30â€“20:30", mapUrl: "https://maps.app.goo.gl/2CctgmqhfxxJiCWC8" },
                            { name: "ã“ã‚“ã´ã‚‰ã†ã©ã‚“", hours: "11:00â€“15:00", mapUrl: "https://maps.app.goo.gl/bfzeUDvUbtPwA8nY9" },
                            { name: "å¯Œç”°å±‹", hours: "11:00â€“21:30", mapUrl: "https://maps.app.goo.gl/jhbLKnyyATwJEJT57" },
                            { name: "Seafood Kawasaki", hours: "11:00â€“13:30" },
                            { name: "å±±æµ·å±‹", hours: "11:00â€“22:00", mapUrl: "https://maps.app.goo.gl/Bm3aLBaWHZshyaYL6" },
                          ] 
                        },
                        { area: "å®®æ´¥æ™šé¤", spots: [{ name: "ãŠé£Ÿäº‹å‡¦ å‰²çƒ¹ãŸã‚“ã”", hours: "17:30â€“22:30" }] }
                    ]
                },
                {
                    date: "1/1ï¼ˆå››ï¼‰",
                    routes: [
                        {
                            area: "å¿ƒé½‹æ©‹",
                            spots: [
                                { name: "å¯¶å¯å¤¢ä¸­å¿ƒ å¤§é˜ªåº— DXå¤§ä¸¸å¿ƒé½‹æ©‹9F", hours: "10:00â€“20:00", mapUrl: "https://maps.app.goo.gl/rRK97UJ6j4x9Hqax9" },
                                { name: "CHIIKAWA LAND Shinsaibashi PARCO Store 6F", hours: "10:00â€“20:00" }
                            ]
                        },
                        {
                            area: "æ¢…ç”°",
                            spots: [
                                { name: "å¯¶å¯å¤¢ä¸­å¿ƒ å¤§é˜ªå¤§ä¸¸æ¢…ç”°13F", hours: "10:00â€“20:00" },
                                { name: "ã¡ã„ã‹ã‚ã‚‰ã‚“ã© å¤§é˜ªæ¢…ç”°åº—", hours: "10:00â€“20:00", note: "æš«å®šé˜ªæ€¥ä¸‰ç•ªè¡—å—é¤¨B1 37è™Ÿ" },
                                { name: "ã‚‰ãéºº é´¨ã¨è‘± æ¢…ç”°åº—", hours: "11:00â€“23:00" },
                                { name: "æ¢…ç”°è—å¤©å¤§æ¨“", hours: "09:30â€“22:00" },
                                { name: "HEP FIVE æ‘©å¤©è¼ª7F", hours: "11:00â€“22:45" }
                            ]
                        }
                    ]
                }
            ]
        };

        // --- 2. State Management ---
        let activeTab = 'itinerary';
        let selectedDayId = 'day1';

        // é‡æ–°ç¹ªè£½æ•´å€‹ App çš„ä¸»è¦å‡½å¼
        function renderApp() {
            renderHeader();
            renderMainContent();
            renderBottomNav();
            
            // æ¯æ¬¡ç‹€æ…‹æ”¹è®Šå¾Œï¼Œå°‡é é¢æ»¾å‹•åˆ°æœ€é ‚ç«¯
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // ç¢ºä¿æ‰€æœ‰ Lucide åœ–ç¤ºè¢«æ­£ç¢ºè§£æ
            renderLucideIcons();
        }

        // ç‹€æ…‹è®Šæ›´å™¨
        function setActiveTabAndRender(tab) {
            activeTab = tab;
            renderApp();
        }

        function setSelectedDayIdAndRender(dayId) {
            selectedDayId = dayId;
            renderApp();
        }

        // --- 3. Icon Mapping & Utility Functions ---
        // ä¾†è‡ª lucide-react çš„åœ–ç¤ºåç¨± (é€™è£¡å°‡è½‰æ›ç‚º HTML/JS çš„æ¸²æŸ“æ–¹å¼)
        const IconMap = {
            MapPin: 'map-pin', Navigation: 'navigation', Utensils: 'utensils', Train: 'train', Sun: 'sun', CloudRain: 'cloud-rain', Cloud: 'cloud', Snowflake: 'snowflake', Info: 'info', ShoppingBag: 'shopping-bag', Calendar: 'calendar', Plane: 'plane', Hotel: 'hotel', Camera: 'camera', Star: 'star', CreditCard: 'credit-card', Car: 'car', NotebookPen: 'notebook-pen', ExternalLink: 'external-link'
        };

        function getIconSVG(name, size = 18, classes = "", strokeWidth = 2) {
            const iconName = IconMap[name];
            // åœ¨ç´” HTML ä¸­ï¼Œstroke-width å¿…é ˆæ˜¯å°å¯«
            return `<i data-lucide="${iconName}" class="${classes}" style="width: ${size}px; height: ${size}px; stroke-width: ${strokeWidth};"></i>`;
        }

        function renderLucideIcons() {
            // æ¯æ¬¡æ¸²æŸ“å…§å®¹å¾Œï¼Œèª¿ç”¨æ­¤å‡½å¼ä¾†è§£ææ‰€æœ‰ [data-lucide] æ¨™ç±¤
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        }
        
        // å–å¾—å¤©æ°£åœ–ç¤ºçš„ HTML
        function getWeatherIconHtml(type) {
            let iconName, color;
            switch (type) {
                case 'sunny': iconName = 'Sun'; color = 'text-orange-500'; break;
                case 'cloudy': iconName = 'Cloud'; color = 'text-gray-500'; break;
                case 'rain': iconName = 'CloudRain'; color = 'text-blue-500'; break;
                case 'snow': iconName = 'Snowflake'; color = 'text-cyan-400'; break;
                default: iconName = 'Sun'; color = 'text-orange-500'; break;
            }
            return getIconSVG(iconName, 20, `w-5 h-5 ${color}`);
        }
        
        // å–å¾— Google åœ°åœ–é€£çµ
        function getGoogleMapUrl(name) {
            return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name)}`;
        }
        
        // Navigation Button Helper
        function renderNavButton(name, url) {
            const destinationUrl = url || getGoogleMapUrl(name);
            return `
                <a 
                    href="${destinationUrl}"
                    target="_blank" 
                    rel="noopener noreferrer"
                    title="ç›®çš„åœ°å°èˆª"
                    class="p-1.5 bg-blue-50 text-blue-600 rounded-full hover:bg-blue-100 transition-colors shrink-0"
                >
                    ${getIconSVG('Navigation', 14)}
                </a>
            `;
        }

        // --- 4. Component Rendering Functions ---

        // A. Itinerary Item Component
        function ItineraryItem(item) {
            // Logic derived from source 49-74
            let IconName = 'MapPin', iconColor = "text-stone-400", borderColor = "border-stone-200";

            if (item.type === 'food') { IconName = 'Utensils'; iconColor = "text-red-400"; borderColor = "border-l-red-400"; }
            else if (item.type === 'shop') { IconName = 'ShoppingBag'; iconColor = "text-yellow-500"; borderColor = "border-l-yellow-500"; }
            else if (item.type === 'visit') { IconName = 'Camera'; iconColor = "text-emerald-500"; borderColor = "border-l-emerald-500"; }
            else if (item.type === 'hotel') { IconName = 'Hotel'; iconColor = "text-purple-400"; borderColor = "border-l-purple-400"; }
            else if (item.type === 'transport') {
                const isFlight = item.title.includes("CX564") || item.title.includes("CX565");
                const isCarRelated = item.title.includes("ç§Ÿè»Š") || item.title.includes("é‚„è»Š") || item.title.includes("é§è»Šå ´");
                if (isFlight) { IconName = 'Plane'; iconColor = "text-red-500"; borderColor = "border-l-red-500"; }
                else if (isCarRelated) { IconName = 'Car'; iconColor = "text-lime-600"; borderColor = "border-l-lime-600"; }
                else { IconName = 'Train'; iconColor = "text-indigo-400"; borderColor = "border-l-indigo-400"; }
            }
            const isCollection = item.tag === "æ”¶é›†";
            if (isCollection) { IconName = 'Star'; iconColor = "text-amber-500"; borderColor = "border-l-amber-500"; }

            const titlesWithoutNavigation = ["æ­ä¹˜ CX564 é£›å¾€å¤§é˜ª", "æ­ä¹˜ CX565 è¿”å°", "å‰å¾€è‰æ´¥", "å‰å¾€å¤§é˜ª"];
            const showNavigation = !titlesWithoutNavigation.includes(item.title) && item.mapUrl !== null;
            
            const Tag = (text, isCollection) => `
                <span class="text-[10px] px-2 py-0.5 rounded-full border ${isCollection ? "border-amber-400 text-amber-600 bg-amber-50" : "border-stone-300 text-stone-500"} font-medium mr-2">
                    ${text}
                </span>`;

            const Highlight = (text) => `
                <div class="mt-2 inline-block px-3 py-1 bg-red-50 text-red-600 text-xs rounded-md font-bold">
                    â˜… ${text}
                </div>`;

            return `
                <div class="flex gap-4 p-4 bg-white rounded-lg border-l-4 shadow-sm mb-3 ${borderColor}">
                    <div class="flex flex-col items-center min-w-[50px]">
                        <span class="text-sm font-bold text-stone-600 font-mono">${item.time}</span>
                        <div class="mt-2 p-1.5 rounded-full bg-stone-50 ${iconColor}">
                            ${getIconSVG(IconName, 18)}
                        </div>
                        ${isCollection ? '<span class="text-[9px] text-amber-600 font-bold mt-1">GET!</span>' : ''}
                    </div>
                    
                    <div class="flex-1">
                        <div class="flex items-start justify-between">
                            <h3 class="font-bold text-stone-800 text-lg leading-tight w-[calc(100%-70px)] sm:w-[calc(100%-110px)]">${item.title}</h3>
                            
                            <div class="flex gap-2 shrink-0"> 
                                ${item.parkingUrl ? `
                                    <a href="${item.parkingUrl}" target="_blank" rel="noopener noreferrer" title="åœè»Šä½ç½®å°èˆª" class="p-1.5 bg-sky-50 text-sky-600 rounded-full hover:bg-sky-100 transition-colors shrink-0">
                                        ${getIconSVG('MapPin', 16)}
                                    </a>
                                ` : ''}
                                ${showNavigation ? renderNavButton(item.title, item.mapUrl) : `<div class="w-7 h-7 shrink-0"></div>`}
                            </div>
                        </div>

                        ${item.tag ? `<div class="mt-1">${Tag(item.tag, isCollection)}</div>` : ''}
                        ${item.highlight ? Highlight(item.highlight) : ''}

                        ${item.note ? `
                            <p class="mt-2 text-sm text-stone-500 leading-relaxed bg-stone-50 p-2 rounded border border-stone-100">
                                ${item.note}
                            </p>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // B. Itinerary Tab Content
        function renderItineraryTab() {
            const currentDayData = TRIP_DATA.itinerary.find(d => d.id === selectedDayId);
            if (!currentDayData) return '<p>æ‰¾ä¸åˆ°ç•¶æ—¥è¡Œç¨‹è³‡è¨Šã€‚</p>';

            const itemsHtml = currentDayData.items.map(ItineraryItem).join('');

            return `
                <div class="animate-fade-in-up">
                    <div class="flex items-center justify-between mb-4 px-1">
                        <h2 class="text-lg font-bold text-stone-700">
                            Day ${selectedDayId.replace('day', '')} 
                            <span class="ml-2 text-sm font-normal text-stone-500">${currentDayData.location}</span>
                        </h2>
                    </div>
                    ${itemsHtml}
                    <div class="h-10"></div> </div>
            `;
        }

        // C. Flights Tab Content
        function renderFlightsTab() {
            const Card = (content) => `<div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">${content}</div>`;

            const flightsHtml = TRIP_DATA.flights.map((flight, idx) => {
                const isDeparture = flight.type === 'Departure';
                const tagClass = isDeparture ? 'bg-indigo-100 text-indigo-700' : 'bg-orange-100 text-orange-700';
                const tagText = isDeparture ? 'å»ç¨‹' : 'å›ç¨‹';

                return Card(`
                    <div class="p-5">
                        <div class="flex items-center justify-between mb-4 border-b border-stone-100 pb-3">
                            <span class="text-xs font-bold px-2 py-1 rounded ${tagClass}">
                                ${tagText}
                            </span>
                            <span class="font-mono font-bold text-stone-500">${flight.date}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <div class="text-3xl font-black text-stone-800">${flight.code}</div>
                            ${getIconSVG('Plane', 24, 'text-stone-300 rotate-45')}
                        </div>
                        <div class="text-sm font-medium text-stone-600 mb-4">${flight.airline} â€¢ ${flight.class}</div>
                        
                        <div class="bg-stone-50 p-4 rounded-lg text-center border border-stone-100">
                            <div class="text-lg font-bold text-stone-800 mb-1">${flight.route}</div>
                            <div class="text-xs text-stone-500">${flight.terminal} â€¢ ${flight.duration} â€¢ ${flight.aircraft}</div>
                        </div>
                    </div>
                `);
            }).join('');

            return `
                <div class="space-y-4 animate-fade-in">
                    <h2 class="text-xl font-bold text-stone-800 px-1">èˆªç­è³‡è¨Š</h2>
                    ${flightsHtml}
                </div>
            `;
        }

        // D. Hotels Tab Content (å·²å„ªåŒ–åœ–ç‰‡éƒ¨åˆ†)
        function renderHotelsTab() {
            const Card = (content) => `<div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">${content}</div>`;

            const hotelsHtml = TRIP_DATA.hotels.map((hotel, idx) => {
                const mapUrl = getGoogleMapUrl(hotel.name);
                const featuresHtml = hotel.features.map(f => `<span class="text-[10px] px-2 py-1 bg-indigo-50 text-indigo-600 rounded">${f}</span>`).join('');

                // ã€åœ–ç‰‡å„ªåŒ–ã€‘ï¼šä½¿ç”¨å…§è¯ style å‹•æ…‹è¨­å®šåœ–ç‰‡
                const imageDiv = `
                    <div 
                        class="h-24"
                        style="
                            background-image: url('${hotel.image}'); 
                            background-size: cover; 
                            background-repeat: no-repeat; 
                            background-position: center center;
                        "
                    >
                    </div>
                `;

                return Card(`
                    ${imageDiv}
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-lg font-bold text-stone-800 leading-tight w-3/4">${hotel.name}</h3>
                            <span class="text-xs bg-stone-100 text-stone-600 px-2 py-1 rounded font-medium whitespace-nowrap">${hotel.dates}</span>
                        </div>
                        <p class="text-xs text-stone-400 mb-4 font-mono">${hotel.engName}</p>
                        
                        <div class="flex items-start gap-2 mb-4 text-sm text-stone-600">
                            ${getIconSVG('MapPin', 16, 'mt-0.5 text-stone-400 shrink-0')}
                            <span>${hotel.location}</span>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-4">
                            ${featuresHtml}
                        </div>

                        <div class="bg-amber-50 p-3 rounded text-xs text-amber-800 border border-amber-100 flex gap-2">
                            ${getIconSVG('Info', 14, 'shrink-0 mt-0.5')}
                            ${hotel.note}
                        </div>
                        
                        <a href="${mapUrl}" target="_blank" class="mt-4 block w-full py-2 bg-stone-800 text-white text-center rounded-lg text-sm font-bold hover:bg-stone-700 transition">
                            å°èˆªè‡³é£¯åº—
                        </a>
                    </div>
                `);
            }).join('');

            return `
                <div class="space-y-4 animate-fade-in">
                    <h2 class="text-xl font-bold text-stone-800 px-1">ä½å®¿è³‡è¨Š</h2>
                    ${hotelsHtml}
                </div>
            `;
        }
        
        // E. Manhole Stock Tab Content
        function renderManholeStockTab() {
            // Logic derived from source 74-86
            const Card = (content) => `<div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">${content}</div>`;

            const tableRows = TRIP_DATA.manholeStock.map((item, index) => {
                const textColorClass = item.highlight ? 'text-red-600 hover:text-red-800' : 'text-indigo-600 hover:text-indigo-800';
                return `
                    <tr class="hover:bg-indigo-50/50 transition-colors">
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-stone-900">${item.region}</td>
                        <td class="px-4 py-3">
                            <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="text-sm font-bold block ${textColorClass}">
                                ${item.name}
                            </a>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-xs">
                            <span class="text-emerald-600 font-bold">
                                ${item.hours}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');

            return `
                <div class="animate-fade-in space-y-4">
                    <h2 class="text-xl font-bold text-stone-800 px-1 flex items-center gap-2">
                        ${getIconSVG('CreditCard', 24, 'text-amber-500')}
                        ãƒãƒ³ãƒ›ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ åœ¨åº«çŠ¶æ³ 
                    </h2>
                    <p class="text-sm text-stone-600 bg-indigo-50 p-3 rounded-lg border border-indigo-100 flex items-center gap-2">
                        ${getIconSVG('Info', 16, 'text-indigo-600 shrink-0')}
                        ç‡Ÿæ¥­æ™‚é–“ç‚ºå®˜æ–¹æä¾›ä¹‹è³‡è¨Šï¼Œè«‹å‹™å¿…å†é»æ“Šé€£çµè‡³å®˜æ–¹ç¶²ç«™ç¢ºèªã€‚
                    </p>

                    ${Card(`
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-stone-200">
                                <thead class="bg-stone-50 sticky top-0">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-stone-600 uppercase tracking-wider w-1/4">åœ°å€</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-stone-600 uppercase tracking-wider w-1/2">åœ°é» (é»æ“ŠæŸ¥è©¢åº«å­˜)</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-stone-600 uppercase tracking-wider w-1/4">ç‡Ÿæ¥­æ™‚é–“</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-stone-100">
                                    ${tableRows}
                                </tbody>
                            </table>
                        </div>
                    `)}
                </div>
            `;
        }
        
        // F. Notes Tab Content
        function renderNotesTab() {
            // Logic derived from source 88-113
            const Card = (content) => `<div class="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden">${content}</div>`;

            const renderTag = (text, color) => `<span class="text-[10px] px-2 py-0.5 rounded-full border ${color} font-medium mr-2">${text}</span>`;


            const notesHtml = TRIP_DATA.notes.map((day, idx) => {
                const linksHtml = day.links ? day.links.map((link, i) => `
                    <a 
                        href="${link.url}" 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="flex items-center justify-between p-3 bg-white border border-indigo-100 rounded-lg shadow-sm hover:bg-indigo-50 transition-colors group"
                    >
                        <div class="flex flex-col">
                            <span class="text-indigo-700 font-bold flex items-center gap-2">
                                ${link.title}
                                ${getIconSVG('ExternalLink', 14, 'opacity-50 group-hover:opacity-100')}
                            </span>
                            ${link.note ? `<span class="text-xs text-stone-500 mt-0.5">${link.note}</span>` : ''}
                        </div>
                    </a>
                `).join('') : '';

                let diningListHtml = '';
                if (day.dining) {
                    // Simple List Structure
                    if (day.dining[0].name) {
                         diningListHtml = `<ul class="space-y-2">
                             ${day.dining.map((spot, i) => `
                                <li class="flex justify-between items-center text-sm">
                                    <div class="flex flex-col">
                                        <span class="font-bold text-stone-700">${spot.name}</span>
                                        <span class="text-xs font-mono text-stone-500 bg-white px-1.5 py-0.5 rounded border border-orange-100 w-fit mt-0.5">${spot.hours}</span>
                                        ${spot.note ? `<span class="text-[10px] text-orange-600 mt-0.5">${spot.note}</span>` : ''}
                                    </div>
                                    ${renderNavButton(spot.name, spot.mapUrl)}
                                </li>
                            `).join('')}
                         </ul>`;
                    } 
                    // Area-based list structure
                    else if (day.dining[0].area) {
                        diningListHtml = `<div class="space-y-3">
                            ${day.dining.map((areaGroup, i) => `
                                <div>
                                    <div class="text-xs font-bold text-stone-500 mb-1 border-b border-orange-200 inline-block">${areaGroup.area}</div>
                                    <ul class="space-y-2 pl-2">
                                        ${areaGroup.spots.map((spot, j) => `
                                            <li class="relative flex justify-between items-start">
                                                <div class="absolute -left-[21px] top-1.5 w-2 h-2 rounded-full bg-orange-300"></div>
                                                <div class="flex-1 pr-2">
                                                    <span class="text-stone-700 font-medium">${spot.name}</span>
                                                    <span class="text-[10px] font-mono text-stone-500">${spot.hours}</span>
                                                    ${spot.note ? `<span class="text-[10px] text-orange-600 mt-0.5">${spot.note}</span>` : ''}
                                                </div>
                                                ${renderNavButton(spot.name, spot.mapUrl)}
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>`;
                    }

                    diningListHtml = `
                        <div class="bg-orange-50/50 rounded-lg p-3 border border-orange-100">
                            <h4 class="text-xs font-bold text-orange-600 mb-2 uppercase tracking-wide flex items-center gap-1">
                                ${getIconSVG('Utensils', 12)} é¤é£²è³‡è¨Š
                            </h4>
                            ${diningListHtml}
                        </div>
                    `;
                }

                let routesHtml = '';
                if (day.routes) {
                    routesHtml = `<div class="space-y-4">
                        ${day.routes.map((route, i) => `
                            <div class="bg-sky-50 rounded-lg p-3 border border-sky-100">
                                <h4 class="font-bold text-sky-800 mb-2 flex items-center gap-2">
                                    ${getIconSVG('MapPin', 14)} ${route.area}
                                </h4>
                                <ul class="space-y-2 relative pl-4 border-l-2 border-sky-200 ml-1">
                                    ${route.spots.map((spot, j) => `
                                        <li class="relative flex justify-between items-start">
                                            <div class="absolute -left-[21px] top-1.5 w-2 h-2 rounded-full bg-sky-300"></div>
                                            <div class="flex-1 pr-2">
                                                <div class="text-sm font-bold text-stone-700">${spot.name}</div>
                                                <div class="text-[10px] text-stone-500 font-mono">${spot.hours}</div>
                                                ${spot.note ? `<div class="text-[10px] text-amber-600 mt-0.5">${spot.note}</div>` : ''}
                                            </div>
                                            ${renderNavButton(spot.name, spot.mapUrl)}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>`;
                }


                return Card(`
                    <div class="p-0 border-l-4 border-l-pink-400">
                        <div class="bg-stone-50 px-4 py-2 border-b border-stone-100 flex justify-between items-center">
                            <h3 class="font-bold text-stone-800">${day.date}</h3>
                        </div>
                        
                        <div class="p-4 space-y-4">
                            ${linksHtml}
                            ${diningListHtml}
                            ${routesHtml}
                        </div>
                    </div>
                `);
            }).join('');

            return `
                <div class="space-y-6 animate-fade-in">
                    <h2 class="text-xl font-bold text-stone-800 px-1 flex items-center gap-2">
                        ${getIconSVG('NotebookPen', 24, 'text-pink-500')}
                        è¡Œç¨‹å‚™è¨»
                    </h2>
                    ${notesHtml}
                </div>
            `;
        }

        // --- 5. Main Layout Rendering ---

        // Render Top Header (Header + Date Selector)
        function renderHeader() {
            const headerContainer = document.getElementById('header-container');
            const currentDayData = TRIP_DATA.itinerary.find(d => d.id === selectedDayId);
            
            // A. Header Bar
            let weatherWidget = '';
            if (activeTab === 'itinerary' && currentDayData) {
                weatherWidget = `
                    <div class="flex items-center gap-2 bg-stone-100 px-3 py-1.5 rounded-full">
                        ${getWeatherIconHtml(currentDayData.weather)}
                        <span class="text-sm font-bold text-stone-600">${currentDayData.temp}</span>
                        <span class="text-xs text-stone-400 pl-1 border-l border-stone-300 ml-1">${currentDayData.location}</span>
                    </div>
                `;
            }

            const headerBar = `
                <div class="px-4 py-3 flex justify-between items-center">
                    <div>
                        <h1 class="text-xl font-black tracking-tighter text-indigo-900">KANSAI TRIP</h1>
                        <p class="text-xs text-stone-400 font-medium tracking-widest">DEC 27 - JAN 04</p>
                    </div>
                    ${weatherWidget}
                </div>
            `;

            // B. Date Selector Scroller
            let dateSelector = '';
            if (activeTab === 'itinerary') {
                const buttons = TRIP_DATA.itinerary.map(day => {
                    const isActive = selectedDayId === day.id;
                    const classes = isActive 
                        ? "bg-indigo-600 border-indigo-600 text-white shadow-lg shadow-indigo-200 scale-105" 
                        : "bg-white border-stone-200 text-stone-400 hover:border-indigo-300";
                    
                    return `
                        <button
                            data-day="${day.id}"
                            onclick="setSelectedDayIdAndRender('${day.id}')"
                            class="flex-shrink-0 snap-center flex flex-col items-center justify-center w-14 h-16 rounded-xl border transition-all duration-300 ${classes}"
                        >
                            <span class="text-[10px] font-medium uppercase leading-none mb-1">${day.date}</span>
                            <span class="text-lg font-black leading-none">${day.dayOfWeek}</span>
                        </button>
                    `;
                }).join('');

                dateSelector = `
                    <div id="date-scroller" class="flex overflow-x-auto gap-3 px-4 pb-3 no-scrollbar snap-x">
                        ${buttons}
                    </div>
                `;
            }
            
            headerContainer.innerHTML = headerBar + dateSelector;
        }

        // Render Main Content Area
        function renderMainContent() {
            const contentArea = document.getElementById('main-content-area');
            let contentHtml = '';

            if (activeTab === 'itinerary') {
                contentHtml = renderItineraryTab();
            } else if (activeTab === 'flights') {
                contentHtml = renderFlightsTab();
            } else if (activeTab === 'hotels') {
                contentHtml = renderHotelsTab();
            } else if (activeTab === 'manhole') {
                contentHtml = renderManholeStockTab();
            } else if (activeTab === 'notes') {
                contentHtml = renderNotesTab();
            }

            contentArea.innerHTML = contentHtml;
        }

        // Render Bottom Navigation
        function renderBottomNav() {
            const navContainer = document.getElementById('bottom-nav-container');
            const tabs = [
                { id: 'itinerary', icon: 'Calendar', label: 'è¡Œç¨‹' },
                { id: 'flights', icon: 'Plane', label: 'èˆªç­' },
                { id: 'hotels', icon: 'Hotel', label: 'ä½å®¿' },
                { id: 'manhole', icon: 'CreditCard', label: 'åœ¨åº«' },
                { id: 'notes', icon: 'NotebookPen', label: 'å‚™è¨»', color: 'text-pink-600' }
            ];

            const buttonsHtml = tabs.map(tab => {
                const isActive = activeTab === tab.id;
                const activeClass = isActive ? (tab.color || 'text-indigo-600') : 'text-stone-400';
                const strokeWidth = isActive ? 2.5 : 2;

                return `
                    <button 
                        onclick="setActiveTabAndRender('${tab.id}')"
                        class="flex flex-col items-center justify-center flex-1 h-full space-y-1 transition-colors ${activeClass}"
                    >
                        ${getIconSVG(tab.icon, 20, '', strokeWidth)}
                        <span class="text-[10px] font-medium">${tab.label}</span>
                    </button>
                `;
            }).join('');

            navContainer.innerHTML = `
                <div class="flex justify-around items-center h-16">
                    ${buttonsHtml}
                </div>
            `;
        }
        
        // Helper to scroll the date buttons
        function scrollToSelectedDayButton() {
            const scrollContainer = document.getElementById('date-scroller');
            if (scrollContainer) {
                const selectedBtn = scrollContainer.querySelector(`[data-day="${selectedDayId}"]`);
                if (selectedBtn) {
                    selectedBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            }
        }

        // --- 6. Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderApp();
            // ç”±æ–¼ renderApp() æ¯æ¬¡éƒ½æœƒé‡æ–°ç¹ªè£½å…§å®¹ï¼Œæˆ‘å€‘éœ€è¦åœ¨å…§å®¹å‘ˆç¾å¾Œå†æ¬¡è§£æåœ–æ¨™
            setInterval(renderLucideIcons, 100); // ç°¡åŒ–è™•ç†ï¼ŒæŒçºŒè§£æ Lucide åœ–æ¨™
            // åˆå§‹æ»¾å‹•ä½ç½®
            setTimeout(scrollToSelectedDayButton, 0); 
        });
    </script>
</body>
</html>
